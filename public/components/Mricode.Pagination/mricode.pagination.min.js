/*!
 * Mricode Pagination Plugin
 * Github: https://github.com/mricle/Mricode.Pagination
 * Version: 1.4.2
 *
 * Required jQuery
 *
 * Copyright 2016 Mricle
 * Released under the MIT license
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?a(require("jquery")):a(jQuery)}(function(a){"use strict";var c,d,e,b=function(b,c){var f={pageIndex:0,pageSize:10,total:0,pageBtnCount:11,showFirstLastBtn:!0,firstBtnText:null,lastBtnText:null,prevBtnText:"&laquo;",nextBtnText:"&raquo;",loadFirstPage:!0,remote:{url:null,params:null,pageParams:null,success:null,beforeSend:null,complete:null,pageIndexName:"pageIndex",pageSizeName:"pageSize",totalName:"total",traditional:!1},pageElementSort:["$page","$size","$jump","$info"],showInfo:!1,infoFormat:"{start} ~ {end} of {total} entires",noInfoText:"0 entires",showJump:!1,jumpBtnText:"Go",showPageSizes:!1,pageSizeItems:[5,10,15,20],debug:!1};this.$element=a(b),this.$page=a('<ul class="m-pagination-page"></ul>').hide(),this.$size=a('<div class="m-pagination-size"></div>').hide(),this.$jump=a('<div class="m-pagination-jump"></div>').hide(),this.$info=a('<div class="m-pagination-info"></div>').hide(),this.options=a.extend(!0,{},f,a.fn.pagination.defaults,c),this.options.pageElementSort=c.pageElementSort?c.pageElementSort:a.fn.pagination.defaults&&a.fn.pagination.defaults.pageElementSort?a.fn.pagination.defaults.pageElementSort:f.pageElementSort,this.options.pageSizeItems=c.pageSizeItems||a.fn.pagination.defaults&&a.fn.pagination.defaults.pageSizeItems?a.fn.pagination.defaults.pageSizeItems:f.pageSizeItems,this.total=this.options.total,this.currentUrl=this.options.remote.url,this.currentPageIndex=e.convertInt(this.options.pageIndex),this.currentPageSize=e.convertInt(this.options.pageSize),this.currentParams=e.deserializeParams(this.options.remote.params)||{},this.getLastPageNum=function(){return d.core.calLastPageNum(this.total,this.currentPageSize)},null===this.options.remote.success&&(this.options.remote.success=this.options.remote.callback),this.init()};b.prototype={getPageIndex:function(){return this.currentPageIndex},getPageSize:function(){return this.currentPageSize},getParams:function(){return this.currentParams},setPageIndex:function(a){void 0!==a&&null!==a&&(this.currentPageIndex=e.convertInt(a))},setPageSize:function(a){void 0!==a&&null!==a&&(this.currentPageSize=e.convertInt(a))},setRemoteUrl:function(a){a&&(this.currentUrl=a)},setParams:function(a){a&&(this.currentParams=e.deserializeParams(a))},render:function(a){void 0!==a&&null!==a&&(this.total=e.convertInt(a)),this.renderPagination(),this.debug("pagination rendered")},init:function(){this.initHtml(),this.initEvent(),this.currentUrl&&this.options.loadFirstPage?this.remote():this.renderPagination(),this.debug("pagination inited")},initHtml:function(){var c,d,b=a('<select data-page-btn="size"></select>');for(c=0;c<this.options.pageSizeItems.length;c++)b.append('<option value="'+this.options.pageSizeItems[c]+'" '+(this.currentPageSize==this.options.pageSizeItems[c]?"selected":"")+" >"+this.options.pageSizeItems[c]+"</option>");for(b.val(this.currentPageSize),this.$size.append(b),d='<div class="m-pagination-group"><input data-page-btn="jump" type="text"><button data-page-btn="jump" type="button">'+this.options.jumpBtnText+"</button></div>",this.$jump.append(d),c=0;c<this.options.pageElementSort.length;c++)this.$element.append(this[this.options.pageElementSort[c]])},initEvent:function(){this.$element.on("click",{page:this},function(b){if(a(b.target).is("button")){if("jump"==a(b.target).data("pageBtn")){var d=b.data.page.$element.find("input[data-page-btn=jump]");b.data.page.jumpEventHandler(d.val(),b)}}else void 0!==a(b.target).data("pageIndex")&&c.call(b.data.page,b)}).on("change",{page:this},function(b){var d=a(b.target);"jump"==d.data("pageBtn")&&b.data.page.jumpEventHandler(d.val(),b),"size"==d.data("pageBtn")&&c.call(b.data.page,b)}).on("keypress",{page:this},function(a){if("13"==a.keyCode){var b=a.data.page.$element.find("input[data-page-btn=jump]");a.data.page.jumpEventHandler(b.val(),a)}})},jumpEventHandler:function(a,b){a?d.check.checkJumpPage(a)?e.convertInt(a)>this.getLastPageNum()?this.$jump.addClass("error"):(this.$jump.removeClass("error"),c.call(this,b)):this.$jump.addClass("error"):this.$jump.removeClass("error")},doPagination:function(){this.currentUrl?this.remote():this.renderPagination()},remote:function(){if("function"==typeof this.options.remote.pageParams){var b=this.options.remote.pageParams.call(this,{pageIndex:this.currentPageIndex,pageSize:this.currentPageSize});this.currentParams=a.extend({},this.currentParams,b)}else this.currentParams[this.options.remote.pageIndexName]=this.currentPageIndex,this.currentParams[this.options.remote.pageSizeName]=this.currentPageSize;d.remote.getAjax(this,this.currentUrl,this.currentParams,this.ajaxCallBack,this.options.remote.beforeSend,this.options.remote.complete)},ajaxCallBack:function(a){var c,b=e.mapObjectNameRecursion(a,this.options.remote.totalName);if(null==b||void 0==b)throw new Error("the response of totalName :  '"+this.options.remote.totalName+"'  not found.");b=e.convertInt(b),this.total=b,c=this.getLastPageNum(),this.currentPageIndex>0&&c-1<this.currentPageIndex?(this.setPageIndex(c-1),this.remote()):("function"==typeof this.options.remote.success&&this.options.remote.success(a),this.renderPagination())},onEvent:function(a,b,c){null!=b&&(this.currentPageIndex=e.convertInt(b)),null!=c&&(this.currentPageSize=e.convertInt(c)),this.doPagination(),this.$element.trigger(a,{pageIndex:this.currentPageIndex,pageSize:this.currentPageSize}),this.debug("pagination "+a)},renderPagination:function(){var a={showFirstLastBtn:this.options.showFirstLastBtn,firstBtnText:this.options.firstBtnText,prevBtnText:this.options.prevBtnText,nextBtnText:this.options.nextBtnText,lastBtnText:this.options.lastBtnText},b=this.getLastPageNum();this.currentPageIndex=b>0&&this.currentPageIndex>b-1?b-1:this.currentPageIndex,this.$page.empty().append(d.core.renderPages(this.currentPageIndex,this.currentPageSize,this.total,this.options.pageBtnCount,a)).show(),b>1?this.$page.show():this.$page.hide(),this.options.showPageSizes&&b>1?this.$size.show():this.$size.hide(),this.options.showJump&&b>1?this.$jump.show():this.$jump.hide(),this.$info.text(d.core.renderInfo(this.currentPageIndex,this.currentPageSize,this.total,this.options.infoFormat,this.options.noInfoText)),this.options.showInfo?this.$info.show():this.$info.hide()},destroy:function(){this.$element.unbind().data("pagination",null).empty(),this.debug("pagination destroyed")},debug:function(a,b){this.options.debug&&console&&(a&&console.info(a+" : pageIndex = "+this.currentPageIndex+" , pageSize = "+this.currentPageSize+" , total = "+this.total),b&&console.info(b))}},c=function(b){var g,h,i,c=b.data.page,f=a(b.target);"click"!==b.type||void 0===f.data("pageIndex")||f.parent().hasClass("active")?"click"!==b.type&&"keypress"!==b.type||"jump"!==f.data("pageBtn")?"change"===b.type&&"size"===f.data("pageBtn")&&(h=c.$size.find("select").val(),i=d.core.calLastPageNum(c.total,h),i>0&&c.currentPageIndex>i-1&&(c.currentPageIndex=i-1),c.onEvent(d.event.pageSizeChanged,c.currentPageIndex,h)):(g=c.$jump.find("input").val(),e.convertInt(g)<=c.getLastPageNum()&&(c.onEvent(d.event.jumpClicked,g-1,null),c.$jump.find("input").val(null))):c.onEvent(d.event.pageClicked,f.data("pageIndex"),null)},d={},d.event={pageClicked:"pageClicked",jumpClicked:"jumpClicked",pageSizeChanged:"pageSizeChanged"},d.remote={getAjax:function(b,c,d,e,f,g){a.ajax({url:c,dataType:"json",data:d,cache:!1,contentType:"application/Json",beforeSend:function(a){"function"==typeof f&&f.call(this,a)},complete:function(a,b){"function"==typeof g&&g.call(this,a,b)},success:function(a){e.call(b,a)}})}},d.core={renderPages:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o;return e=e||{},f=a+1,g=this.calLastPageNum(c,b),h=[],d>=g?h=this.renderGroupPages(1,g,f):(i=this.renderPerPage(e.firstBtnText||1,0),j=this.renderPerPage(e.lastBtnText||g,g-1),k=(d-1-4)/2,e.showFirstLastBtn||(k+=1),l=(d+1)/2,m=g-(d+1)/2,n=this.renderPerPage(e.prevBtnText,a-1),o=this.renderPerPage(e.nextBtnText,a+1),k=-1==k.toString().indexOf(".")?k:k+.5,l=-1==l.toString().indexOf(".")?l:l+.5,m=-1==m.toString().indexOf(".")?m:m+.5,l>f?e.showFirstLastBtn?(h=this.renderGroupPages(1,d-2,f),h.push(o),h.push(j)):(h=this.renderGroupPages(1,d-1,f),h.push(o)):f>m?e.showFirstLastBtn?(h=this.renderGroupPages(g-d+3,d-2,f),h.unshift(n),h.unshift(i)):(h=this.renderGroupPages(g-d+2,d-1,f),h.unshift(n)):e.showFirstLastBtn?(h=this.renderGroupPages(f-k,d-4,f),h.unshift(n),h.push(o),h.unshift(i),h.push(j)):(h=this.renderGroupPages(f-k,d-2,f),h.unshift(n),h.push(o))),h},renderGroupPages:function(a,b,c){var e,f,d=[];for(e=0;b>e;e++)f=this.renderPerPage(a,a-1),a===c&&f.addClass("active"),d.push(f),a++;return d},renderPerPage:function(b,c){return a("<li><a data-page-index='"+c+"'>"+b+"</a></li>")},renderInfo:function(a,b,c,d,e){var f,g;return 0>=c?e:(f=a*b+1,g=(a+1)*b,g=g>=c?c:g,d.replace("{start}",f).replace("{end}",g).replace("{total}",c))},calLastPageNum:function(a,b){a=e.convertInt(a),b=e.convertInt(b);var c=a/b;return e.isDecimal(c)?parseInt(c)+1:c}},d.check={checkJumpPage:function(a){var b=/^\+?[1-9][0-9]*$/;return b.test(a)}},e={convertInt:function(a){if("number"==typeof a)return a;var b=parseInt(a);if(isNaN(b))throw new Error("convertInt Type Error.  Type is "+typeof a+", value = "+a);return b},isDecimal:function(a){return parseInt(a)!==a},mapObjectNameRecursion:function(a,b){var f,c=a,d=b.split(".");for(f=0;f<d.length;f++)c=e.mapObjectName(c,d[f]);return c},mapObjectName:function(a,b){var d,c=null;for(d in a)if(a.hasOwnProperty(d)&&d==b){c=a[d];break}return c},deserializeParams:function(a){var c,d,e,b={};if("string"==typeof a)for(c=a.split("&"),d=0;d<c.length;d++)e=c[d].split("="),b[e[0]]=decodeURIComponent(e[1]);else if(a instanceof Array)for(d=0;d<a.length;d++)b[a[d].name]=decodeURIComponent(a[d].value);else"object"==typeof a&&(b=a);return b}},a.fn.pagination=function(c){var d,e;return"undefined"==typeof c?a(this).data("pagination")||!1:(e=arguments,this.each(function(){var h,i,f=a(this),g=f.data("pagination");if(!g&&"string"==typeof c)throw new Error("MricodePagination is uninitialized.");if(g&&"object"==typeof c)throw new Error("MricodePagination is initialized.");g||"object"!=typeof c?g&&"string"==typeof c&&(d=g[c].apply(g,Array.prototype.slice.call(e,1))):(h="object"==typeof c&&c,i=f.data(),h=a.extend(h,i),f.data("pagination",g=new b(this,h)))}),"undefined"==typeof d?this:d)}});